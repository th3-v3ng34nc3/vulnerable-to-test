name: AccuKnox Vulnerability Scan
description: Scan Docker images using AccuKnox and push the results to the CSPM panel.

inputs:
  docker_image:
    description: 'Defines docker_image variable with base name repo and dynamic tag from github.run_id'
    required: true
  dockerfile_context:
    description: 'The context of the Dockerfile to use for building the image.'
    required: true
    default: 'Dockerfile'
  cspm_url:
    description: 'The URL of the CSPM panel to push the scan results to.'
    required: true
  cspm_token:
    description: 'The token for authenticating with the CSPM panel.'
    required: true
  tenant_id:
    description: 'The ID of the tenant associated with the CSPM panel.'
    required: true
env:
 command: curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin
runs:
  using: 'composite'
  steps:
    - name: Download AccuKnox Vulnerability Scanner
      run: ${{ env.command }}
      shell: bash
    - name: Run AccuKnox Vulnerability Scanner
      run: echo "Running AccuKnox Vulnerability Scanner"
      shell: bash
    - name: Print AccuKnox Results
      run: echo "Printing AccuKnox Results"
      shell: bash
    - name: Push report to CSPM panel
      run: echo "Pushing report to CSPM panel"
      shell: bash
